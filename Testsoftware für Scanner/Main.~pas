unit Main;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  StdCtrls, ExtCtrls, CfgUnit;


type
  TForm1 = class(TForm)
    Panel1: TPanel;
    Edit1: TEdit;
    Button3: TButton;
    Memo1: TMemo;
    Button4: TButton;
    Panel2: TPanel;
    GroupBox1: TGroupBox;
    GroupBox2: TGroupBox;
    ComboBox4: TComboBox;
    RadioButton1: TRadioButton;
    Button5: TButton;
    Button6: TButton;
    ComboBox1: TComboBox;
    Button9: TButton;
    Button10: TButton;
    RadioButton6: TRadioButton;
    RadioButton7: TRadioButton;
    RadioButton8: TRadioButton;
    Panel3: TPanel;
    Memo2: TMemo;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Button7: TButton;
    GroupBox3: TGroupBox;
    Button1: TButton;
    Button2: TButton;
    Button8: TButton;
    Button11: TButton;
    Button12: TButton;
    Button13: TButton;
    Button14: TButton;
    Button15: TButton;
    Button16: TButton;
    GroupBox4: TGroupBox;
    Button18: TButton;
    Button17: TButton;
    Button19: TButton;
    Button20: TButton;
    Button21: TButton;
    Button22: TButton;
    Button23: TButton;
    Button24: TButton;
    Button25: TButton;
    Button26: TButton;
    Button27: TButton;
    Edit2: TEdit;
    Edit3: TEdit;
    Edit4: TEdit;
    Edit5: TEdit;
    Edit6: TEdit;
    Edit7: TEdit;
    Edit8: TEdit;
    Edit9: TEdit;
    Edit10: TEdit;
    Edit11: TEdit;
    Edit12: TEdit;
    Edit13: TEdit;
    Edit14: TEdit;
    Edit15: TEdit;
    Edit16: TEdit;
    Edit17: TEdit;
    Edit18: TEdit;
    Edit19: TEdit;
    Edit20: TEdit;
    Edit21: TEdit;
    Edit22: TEdit;
    Edit23: TEdit;
    Edit24: TEdit;
    Edit25: TEdit;
    Edit26: TEdit;
    Edit27: TEdit;
    Edit28: TEdit;
    Edit29: TEdit;
    Edit30: TEdit;
    Edit31: TEdit;
    Edit32: TEdit;
    Edit33: TEdit;
    Edit34: TEdit;
    Edit35: TEdit;
    Edit36: TEdit;
    Edit37: TEdit;
    Edit38: TEdit;
    Edit39: TEdit;
    Edit40: TEdit;
    Edit41: TEdit;
    RadioButton2: TRadioButton;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Label9: TLabel;
    Label10: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    Label13: TLabel;
    Label14: TLabel;
    Label15: TLabel;
    Label16: TLabel;
    Label17: TLabel;
    Label18: TLabel;
    Label19: TLabel;
    Label20: TLabel;
    Label21: TLabel;
    Label22: TLabel;
    Label23: TLabel;
    Label24: TLabel;
    Label25: TLabel;
    Label26: TLabel;
    Label27: TLabel;
    Label28: TLabel;
    Label29: TLabel;
    Label30: TLabel;
    Label31: TLabel;
    Label32: TLabel;
    Label33: TLabel;
    Label34: TLabel;
    Label35: TLabel;
    Label36: TLabel;
    Label37: TLabel;
    Label38: TLabel;
    Label39: TLabel;
    Label40: TLabel;
    Label41: TLabel;
    Label42: TLabel;
    Label43: TLabel;
    Label44: TLabel;
    Label45: TLabel;
    ComboBox2: TComboBox;
    Label4: TLabel;
    procedure Button4Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure RadioButton2Click(Sender: TObject);
    procedure RadioButton1Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure ComboBox4Change(Sender: TObject);
    
    
    procedure Button7Click(Sender: TObject);
 
    procedure ComboBox1DropDown(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure Button10Click(Sender: TObject);
    procedure Button9Click(Sender: TObject);

    procedure RadioButton6Click(Sender: TObject);
    procedure RadioButton7Click(Sender: TObject);
    procedure RadioButton8Click(Sender: TObject);
    procedure Edit1KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);




    procedure Edit2Change(Sender: TObject);
    procedure Edit3Change(Sender: TObject);
    procedure Edit4Change(Sender: TObject);
    procedure Edit5Change(Sender: TObject);
    procedure Edit6Change(Sender: TObject);
    procedure Edit7Change(Sender: TObject);
    procedure Edit8Change(Sender: TObject);
    procedure Edit9Change(Sender: TObject);
    procedure Edit10Change(Sender: TObject);
    procedure Edit11Change(Sender: TObject);
    procedure Edit12Change(Sender: TObject);
    procedure Edit13Change(Sender: TObject);
    procedure Edit14Change(Sender: TObject);
    procedure Edit15Change(Sender: TObject);
    procedure Edit16Change(Sender: TObject);
    procedure Edit17Change(Sender: TObject);
    procedure Edit18Change(Sender: TObject);
    procedure Edit19Change(Sender: TObject);
    procedure Edit20Change(Sender: TObject);
    procedure Edit21Change(Sender: TObject);
    procedure Edit22Change(Sender: TObject);
    procedure Edit23Change(Sender: TObject);
    procedure Edit24Change(Sender: TObject);
    procedure Edit25Change(Sender: TObject);
    procedure Edit26Change(Sender: TObject);
    procedure Edit27Change(Sender: TObject);
    procedure Edit28Change(Sender: TObject);
    procedure Edit29Change(Sender: TObject);
    procedure Edit30Change(Sender: TObject);
    procedure Edit31Change(Sender: TObject);
    procedure Edit32Change(Sender: TObject);
    procedure Edit33Change(Sender: TObject);
    procedure Edit34Change(Sender: TObject);
    procedure Edit35Change(Sender: TObject);
    procedure Edit36Change(Sender: TObject);
    procedure Edit37Change(Sender: TObject);
    procedure Edit38Change(Sender: TObject);
    procedure Edit39Change(Sender: TObject);
    procedure Edit40Change(Sender: TObject);
    procedure Edit41Change(Sender: TObject);

    procedure Edit23KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit22KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit24KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit25KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit26KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit27KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit28KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit29KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit30KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit31KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit32KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit33KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit34KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit35KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit36KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit37KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit38KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit39KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit40KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Edit41KeyDown(Sender: TObject; var Key: Word;
      Shift: TShiftState);
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button8Click(Sender: TObject);
    procedure Button11Click(Sender: TObject);
    procedure Button12Click(Sender: TObject);
    procedure Button13Click(Sender: TObject);
    procedure Button14Click(Sender: TObject);
    procedure Button15Click(Sender: TObject);
    procedure Button16Click(Sender: TObject);
    procedure Button17Click(Sender: TObject);
    procedure Button18Click(Sender: TObject);
    procedure Button19Click(Sender: TObject);
    procedure Button20Click(Sender: TObject);
    procedure Button21Click(Sender: TObject);
    procedure Button22Click(Sender: TObject);
    procedure Button23Click(Sender: TObject);
    procedure Button24Click(Sender: TObject);
    procedure Button25Click(Sender: TObject);
    procedure Button26Click(Sender: TObject);
    procedure Button27Click(Sender: TObject);



    procedure ComboBox2Click(Sender: TObject);

    


  private
    { Private declarations }
  public
    { Public declarations }
    function GetProgrammDirectory: string;
    procedure SaveEdit;
    procedure ReadBackEdit;


    procedure Sende(Kommand : string);
    // ***  RS232  ***
    procedure ChangeComPort;

    // ***  FTDI  ***
    procedure InitUart;
    procedure FindDevice;
    procedure FTDI_open;
    procedure FTDI_close;

    procedure ButtonOFF;
    procedure ButtonOn;

    procedure SendBefehl_1;
    procedure SendBefehl_2;
    procedure SendBefehl_3;
    procedure SendBefehl_4;
    procedure SendBefehl_5;
    procedure SendBefehl_6;
    procedure SendBefehl_7;
    procedure SendBefehl_8;
    procedure SendBefehl_9;
    procedure SendBefehl_10;
    procedure SendBefehl_11;
    procedure SendBefehl_12;
    procedure SendBefehl_13;
    procedure SendBefehl_14;
    procedure SendBefehl_15;
    procedure SendBefehl_16;
    procedure SendBefehl_17;
    procedure SendBefehl_18;
    procedure SendBefehl_19;
    procedure SendBefehl_20;

    procedure SetzeBaudrate;

  end;

var
  Form1: TForm1;

  //ComCreate     : integer = 0;  04.12.2017
  schnittstelle : integer = 1;

  PortOpen : integer = 0;
  Dateiname : string;

implementation

uses //Comms,RS232, 04.12.2017
     FTDI, D2XXUnit;


{$R *.DFM}

function TForm1.GetProgrammDirectory: string;
begin
  Result := ExtractFilePath(ParamStr(0));
end;

procedure Tform1.SaveEdit;
var
  List: TStrings;
  dirrectory : string;
begin
  List := TStringList.Create;
  try
    List.Add(Edit2.Text);
    List.Add(Edit3.Text);
    List.Add(Edit4.Text);
    List.Add(Edit5.Text);
    List.Add(Edit6.Text);
    List.Add(Edit7.Text);
    List.Add(Edit8.Text);
    List.Add(Edit9.Text);
    List.Add(Edit10.Text);
    List.Add(Edit11.Text);
    List.Add(Edit12.Text);
    List.Add(Edit13.Text);
    List.Add(Edit14.Text);
    List.Add(Edit15.Text);
    List.Add(Edit16.Text);
    List.Add(Edit17.Text);
    List.Add(Edit18.Text);
    List.Add(Edit19.Text);
    List.Add(Edit20.Text);
    List.Add(Edit21.Text);
    List.Add(Edit22.Text);
    List.Add(Edit23.Text);
    List.Add(Edit24.Text);
    List.Add(Edit25.Text);
    List.Add(Edit26.Text);
    List.Add(Edit27.Text);
    List.Add(Edit28.Text);
    List.Add(Edit29.Text);
    List.Add(Edit30.Text);
    List.Add(Edit31.Text);
    List.Add(Edit32.Text);
    List.Add(Edit33.Text);
    List.Add(Edit34.Text);
    List.Add(Edit35.Text);
    List.Add(Edit36.Text);
    List.Add(Edit37.Text);
    List.Add(Edit38.Text);
    List.Add(Edit39.Text);
    List.Add(Edit40.Text);
    List.Add(Edit41.Text);

    Dirrectory := GetProgrammDirectory;
    List.SaveToFile(Dirrectory + Dateiname +'.txt');
  finally
    List.Free;
  end;
end;

procedure tform1.ReadBackEdit;
var
  List: TStrings;
  dirrectory : string;
begin
  Dirrectory := GetProgrammDirectory;
  if FileExists(Dirrectory + Dateiname +'.txt') then
  begin
    List := TStringList.Create;
    try
      List.LoadFromFile(Dirrectory + Dateiname +'.txt');
      if List.Count>0 then
        Edit2.Text:=List[0];
        Edit3.Text:=List[1];
        Edit4.Text:=List[2];
        Edit5.Text:=List[3];
        Edit6.Text:=List[4];
        Edit7.Text:=List[5];
        Edit8.Text:=List[6];
        Edit9.Text:=List[7];
        Edit10.Text:=List[8];
        Edit11.Text:=List[9];
        Edit12.Text:=List[10];
        Edit13.Text:=List[11];
        Edit14.Text:=List[12];
        Edit15.Text:=List[13];
        Edit16.Text:=List[14];
        Edit17.Text:=List[15];
        Edit18.Text:=List[16];
        Edit19.Text:=List[17];
        Edit20.Text:=List[18];
        Edit21.Text:=List[19];
        Edit22.Text:=List[20];
        Edit23.Text:=List[21];
        Edit24.Text:=List[22];
        Edit25.Text:=List[23];
        Edit26.Text:=List[24];
        Edit27.Text:=List[25];
        Edit28.Text:=List[26];
        Edit29.Text:=List[27];
        Edit30.Text:=List[28];
        Edit31.Text:=List[29];
        Edit32.Text:=List[30];
        Edit33.Text:=List[31];
        Edit34.Text:=List[32];
        Edit35.Text:=List[33];
        Edit36.Text:=List[34];
        Edit37.Text:=List[35];
        Edit38.Text:=List[36];
        Edit39.Text:=List[37];
        Edit40.Text:=List[38];
        Edit41.Text:=List[39];
    finally
        List.Free;
    end;
  end
  else
  begin

    edit2.text:= '';
    edit3.text:= '';
    edit4.text:= '';
    edit5.text:= '';
    edit6.text:= '';
    edit7.text:= '';
    edit8.text:= '';
    edit9.text:= '';
    edit10.text:= '';
    edit11.text:= '';
    edit12.text:= '';
    edit13.text:= '';
    edit14.text:= '';
    edit15.text:= '';
    edit16.text:= '';
    edit17.text:= '';
    edit18.text:= '';
    edit19.text:= '';
    edit20.text:= '';
    edit21.text:= '';
    edit22.text:= '';
    edit23.text:= '';
    edit24.text:= '';
    edit25.text:= '';
    edit26.text:= '';
    edit27.text:= '';
    edit28.text:= '';
    edit29.text:= '';
    edit30.text:= '';
    edit31.text:= '';
    edit32.text:= '';
    edit33.text:= '';
    edit34.text:= '';
    edit35.text:= '';
    edit36.text:= '';
    edit37.text:= '';
    edit38.text:= '';
    edit39.text:= '';
    edit40.text:= '';
    edit41.text:= '';
    showmessage('Command table ot present');
  end;
end;

procedure Tform1.SendBefehl_1;
begin
  Memo2.clear;
  Sende ('1,' + edit22.Text);
end;

procedure Tform1.SendBefehl_2;
begin
  Memo2.clear;
  Sende ('2,' + edit23.Text);
end;

procedure Tform1.SendBefehl_3;
begin
  Memo2.clear;
  Sende ('3,' + edit24.Text);
end;

procedure Tform1.SendBefehl_4;
begin
  Memo2.clear;
  Sende ('4,' + edit25.Text);
end;

procedure Tform1.SendBefehl_5;
begin
  Memo2.clear;
  Sende ('5,' + edit26.Text);
end;

procedure Tform1.SendBefehl_6;
begin
  Memo2.clear;
  Sende ('6,' + edit27.Text);
end;

procedure Tform1.SendBefehl_7;
begin
  Memo2.clear;
  Sende ('7,' + edit28.Text);
end;

procedure Tform1.SendBefehl_8;
begin
  Memo2.clear;
  Sende ('8,' + edit29.Text);
end;

procedure Tform1.SendBefehl_9;
begin
  Memo2.clear;
  Sende ('9,' + edit30.Text);
end;

procedure Tform1.SendBefehl_10;
begin
  Memo2.clear;
  Sende ('10,' + edit31.Text);
end;

procedure Tform1.SendBefehl_11;
begin
  Memo2.clear;
  Sende ('11,' + edit32.Text);
end;

procedure Tform1.SendBefehl_12;
begin
  Memo2.clear;
  Sende ('12,' + edit33.Text);
end;

procedure Tform1.SendBefehl_13;
begin
  Memo2.clear;
  Sende ('13,' + edit34.Text);
end;

procedure Tform1.SendBefehl_14;
begin
  Memo2.clear;
  Sende ('14,' + edit35.Text);
end;

procedure Tform1.SendBefehl_15;
begin
  Memo2.clear;
  Sende ('15,' + edit36.Text);
end;

procedure Tform1.SendBefehl_16;
begin
  Memo2.clear;
  Sende ('16,' + edit37.Text);
end;

procedure Tform1.SendBefehl_17;
begin
  Memo2.clear;
  Sende ('17,' + edit38.Text);
end;

procedure Tform1.SendBefehl_18;
begin
  Memo2.clear;
  Sende ('18,' + edit39.Text);
end;

procedure Tform1.SendBefehl_19;
begin
  Memo2.clear;
  Sende ('19,' + edit40.Text);
end;

procedure Tform1.SendBefehl_20;
begin
  Memo2.clear;
  Sende ('20,' + edit41.Text);
end;





//  **************  ALT *****************
procedure TForm1.ButtonOFF;
begin
  button10.Enabled:= false;
  button3.Enabled:= false;
  button6.Enabled:= true;
  groupbox3.Enabled := false;
  groupbox4.Enabled := false;
  combobox2.Enabled := false;
end;

procedure TForm1.ButtonOn;
begin
  button6.Enabled:= false;
  button10.Enabled:= true;
  button3.Enabled:= true;
  panel3.Enabled := true;
  groupbox3.Enabled := true;
  groupbox4.Enabled := true;
  combobox2.Enabled := true;
end;

// **********  FTDI  ****************


procedure TForm1.InitUart;
var status : integer;
begin
 // if RBpollON.Checked = true then
   // timer1.Enabled := false;

  //open;
{  FT_Current_Baud := FT_BAUD_9600 ;        //Set_USB_Device_BaudRate
  FT_Current_DataBits := FT_DATA_BITS_8 ;  //Set_USB_Device_DataCharacteristics
  FT_Current_Parity := FT_PARITY_NONE ;    //Set_USB_Device_DataCharacteristics
  FT_Current_StopBits := FT_STOP_BITS_1 ;  //Set_USB_Device_DataCharacteristics
  FT_Current_FlowControl := FT_FLOW_NONE ; //Set_USB_Device_FlowControl

 }

  Set_USB_Device_BaudRate;
  Set_USB_Device_DataCharacteristics;
  Set_USB_Device_FlowControl;

  //if RBpollON.Checked = true then
    //timer1.Enabled := true;

  //close;

end;

procedure Tform1.FindDevice;
var S:String; DeviceIndex : DWord; I : Integer;
begin
 {
  if RBpollON.Checked = true then
    timer1.Enabled := false;
 }
GetFTDeviceCount;
S := IntToStr(FT_Device_Count);

DeviceIndex := 0;
If FT_Device_Count > 0 then
  For I := 1 to FT_Device_Count do
  Begin
 { LV := ListView1.Items.Add;
  LV.Caption := 'Device '+IntToStr(I);
  GetFTDeviceSerialNo( DeviceIndex );
  LV.SubItems.Add(FT_Device_String); }
  GetFTDeviceDescription ( DeviceIndex );
  Form1.ComboBox1.Items.Add(FT_Device_String);
  //showmessage(FT_Device_String);
  combobox1.ItemIndex :=0;
  DeviceIndex := DeviceIndex + 1;
  End;

 { if RBpollON.Checked = true then
    timer1.Enabled := true;
   }
end;

procedure TForm1.FTDI_open;
var res   : integer;
    DName : string;
begin
  DName := form1.ComboBox1.Text;
  res := Open_USB_Device_By_Device_Description(DName);
  //showmessage(inttostr(res));
  InitUart;
end;

procedure TForm1.FTDI_close;
var res : integer;
begin
  res := Close_USB_Device;
end;

// **********   RS232  **************

procedure TForm1.Sende(Kommand : string);
var
  DName : string;
  stat : integer;
  res   : integer;
  DataStrg : string;
begin
  Memo1.Lines.Add('Transm > '+ Kommand);

  // *** FTDI ***
  if schnittstelle = 1 then
  begin
    FT_RS232_Send(DName,Kommand);


    stat:=FT_WaitOnChar;
    //FT_Wait_On_Char;
    if stat = 0 then
    begin

      //sleep(100);

      res := FT_RS232_Read(DataStrg,DName);
      if res = 0 then
      begin
        Memo1.Lines.Add('Receiv > '+ DataStrg);

      end
      else
        memo1.Lines.Add('No return received ' + DataStrg) ;
    end
    else


    //close;
  end;

  // *** RS232 ***   04.12.2017
 { if schnittstelle = 2 then
  begin
    RS232_Write(Kommand);
    DataStrg := RS232_Read;
    Memo1.Lines.Add('Receiv > '+ DataStrg);
  end; }
  
end;

procedure TForm1.ChangeComPort;
begin
 {case combobox4.itemindex of
   0: Port := com1;
   1: port := com2;
   2: Port := com3;
   3: Port := com4;
   4: Port := com5;
   5: Port := com6;
   6: Port := com7;
   7: Port := com8;
 end;  }
end;


procedure TForm1.Button4Click(Sender: TObject);
begin
   memo1.Clear;
end;

procedure TForm1.Button5Click(Sender: TObject);
begin
 { if  ComCreate = 0 then
  begin
    ComCreate := 1;
    com := Tcomport.Create(self); //.Create(self);
    
  end;

  ComSettings;
  OpenCom;
  ButtonOn;
  PortOpen := 1;    04.12.2017}
end;

procedure TForm1.RadioButton2Click(Sender: TObject);
begin
  schnittstelle := 2;  // RS232
  ButtonOFF;
  if PortOpen = 2 then
  begin
     FTDI_close;
     portopen := 0;

  end;


  button6.enabled := false;
  button10.enabled := false;
  button5.enabled := true;
  button9.enabled := true;
end;

procedure TForm1.RadioButton1Click(Sender: TObject);
begin
 { schnittstelle := 1; // FTDI
  ButtonOFF;
  if portopen = 1 then
  begin
    portopen := 0;
    CloseCom;

  end;
  

  button6.enabled := true;
  button10.enabled := true;
  button5.enabled := false;
  button9.enabled := false;   04.12.2017}
end;

procedure TForm1.Button3Click(Sender: TObject);
var
  Kommand : string;
begin
  Memo2.clear;
  Sende (edit1.Text);

end;
procedure TForm1.FormCreate(Sender: TObject);
begin
  Label6.caption:='--';
  Label7.caption:='--';
  Label8.caption:='--';
  Label9.caption:='--';
  Label10.caption:='--';
  Label11.caption:='--';
  Label12.caption:='--';
  Label13.caption:='--';
  Label14.caption:='--';
  Label15.caption:='--';
  Label16.caption:='--';
  Label17.caption:='--';
  Label18.caption:='--';
  Label19.caption:='--';
  Label20.caption:='--';
  Label21.caption:='--';
  Label22.caption:='--';
  Label23.caption:='--';
  Label24.caption:='--';
  Label25.caption:='--';

  combobox2.ItemIndex := 0;

  ButtonOFF;

  memo1.Clear;

  combobox4.ItemIndex := 1;
  ChangeComPort;
  
 // *** FTDI ***
 if radiobutton1.Checked = true then
 begin
    schnittstelle := 1;
    button5.enabled := false;
    button9.enabled := false;
 end;

 // *** RS232 ***
 if Radiobutton2.Checked = true then
 begin
    schnittstelle := 2;

    button6.enabled := false;
    button10.enabled := false;
 end;



  // ** default Uart Einstellungen **
  //FT_Current_Baud := FT_BAUD_9600 ;        //Set_USB_Device_BaudRate
  //FT_Current_Baud := FT_BAUD_19200 ;        //Set_USB_Device_BaudRate
  SetzeBaudrate;
  FT_Current_DataBits := FT_DATA_BITS_8 ;  //Set_USB_Device_DataCharacteristics
  FT_Current_Parity := FT_PARITY_NONE ;    //Set_USB_Device_DataCharacteristics
  FT_Current_StopBits := FT_STOP_BITS_1 ;  //Set_USB_Device_DataCharacteristics
  FT_Current_FlowControl := FT_FLOW_NONE ; //Set_USB_Device_FlowControl

  FindDevice;
  Dateiname := combobox1.Text;
  if Dateiname <> '' then
     ReadBackEdit;

end;

procedure TForm1.ComboBox4Change(Sender: TObject);
begin
  ChangeComPort;
end;





procedure TForm1.Button7Click(Sender: TObject);
begin
  memo2.Clear;
end;



procedure TForm1.ComboBox1DropDown(Sender: TObject);
begin
  combobox1.Clear;
  combobox1.Text:='';
  FindDevice;
  combobox1.DropDownCount := 8;
end;

procedure TForm1.Button6Click(Sender: TObject);
begin
  FTDI_open;
  ButtonOn;
  PortOpen := 2;
end;

procedure TForm1.Button10Click(Sender: TObject);
begin
   FTDI_close;
   portopen := 0;
   ButtonOFF;
end;

procedure TForm1.Button9Click(Sender: TObject);
begin
 { portopen := 0;
  CloseCom;  04.12.2017}
end;











procedure TForm1.RadioButton6Click(Sender: TObject);
begin
  //BauRate := br9600;   04.12.2017
end;

procedure TForm1.RadioButton7Click(Sender: TObject);
begin
  //BauRate := br19200;  04.12.2017
end;

procedure TForm1.RadioButton8Click(Sender: TObject);
begin
  // BauRate := br38400; 04.12.2017
end;

procedure TForm1.Edit1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
begin
  if key = 13 then
  begin
    Memo2.clear;
    Sende (edit1.Text);
  end;

end;









procedure TForm1.Edit2Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit3Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit4Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit5Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit6Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit7Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit8Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit9Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit10Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit11Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit12Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit13Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit14Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit15Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit16Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit17Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit18Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit19Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit20Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit21Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit22Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit23Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit24Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit25Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit26Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit27Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit28Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit29Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit30Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit31Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit32Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit33Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit34Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit35Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit36Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit37Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit38Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit39Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit40Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit41Change(Sender: TObject);
begin
  SaveEdit;
end;

procedure TForm1.Edit22KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_1;
    ez:=gettickcount;
    label6.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit23KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
    az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_2;
    ez:=gettickcount;
    label7.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit24KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_3;
    ez:=gettickcount;
    label8.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit25KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_4;
    ez:=gettickcount;
    label9.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit26KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_5;
    ez:=gettickcount;
    label10.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit27KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_6;
    ez:=gettickcount;
    label11.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit28KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_7;
    ez:=gettickcount;
    label12.caption:=inttostr(ez-az);
  end;
end;
procedure TForm1.Edit29KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_8;
    ez:=gettickcount;
    label13.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit30KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_9;
    ez:=gettickcount;
    label14.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit31KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_10;
    ez:=gettickcount;
    label15.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit32KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_11;
    ez:=gettickcount;
    label16.caption:=inttostr(ez-az);
  end;
end;
procedure TForm1.Edit33KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_12;
    ez:=gettickcount;
    label17.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit34KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_13;
    ez:=gettickcount;
    label18.caption:=inttostr(ez-az);
  end;
end;
procedure TForm1.Edit35KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_14;
    ez:=gettickcount;
    label19.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit36KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_15;
    ez:=gettickcount;
    label20.caption:=inttostr(ez-az);

    // Automatische Umschaltung der Baudrate vom PC Programm
    FTDI_close;
    portopen := 0;
    ButtonOFF;
    sleep(500);
    combobox2.ItemIndex := strtoint(edit36.text) - 1;
    SetzeBaudrate;

    FTDI_open;
    ButtonOn;
    PortOpen := 2;
  end;
end;

procedure TForm1.Edit37KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_16;
    ez:=gettickcount;
    label21.caption:=inttostr(ez-az);
  end;
end;
procedure TForm1.Edit38KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_17;
    ez:=gettickcount;
    label22.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit39KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_18;
    ez:=gettickcount;
    label23.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit40KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_19;
    ez:=gettickcount;
    label24.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Edit41KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var
  Kommand : string;
  az,ez:integer;
begin
  if key = 13 then
  begin
    az:=gettickcount;
    SendBefehl_20;
    ez:=gettickcount;
    label25.caption:=inttostr(ez-az);
  end;
end;

procedure TForm1.Button1Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_1;
  ez:=gettickcount;
  label6.caption:=inttostr(ez-az);
end;

procedure TForm1.Button2Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_2;
  ez:=gettickcount;
  label7.caption:=inttostr(ez-az);
end;

procedure TForm1.Button8Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_3;
  ez:=gettickcount;
  label8.caption:=inttostr(ez-az);
end;

procedure TForm1.Button11Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_4;
  ez:=gettickcount;
  label9.caption:=inttostr(ez-az);
end;

procedure TForm1.Button12Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_5;
  ez:=gettickcount;
  label10.caption:=inttostr(ez-az);
end;

procedure TForm1.Button13Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_6;
  ez:=gettickcount;
  label11.caption:=inttostr(ez-az);
end;

procedure TForm1.Button14Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_7;
  ez:=gettickcount;
  label12.caption:=inttostr(ez-az);
end;

procedure TForm1.Button15Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_8;
  ez:=gettickcount;
  label13.caption:=inttostr(ez-az);
end;

procedure TForm1.Button16Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_9;
  ez:=gettickcount;
  label14.caption:=inttostr(ez-az);
end;

procedure TForm1.Button17Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_10;
  ez:=gettickcount;
  label15.caption:=inttostr(ez-az);
end;

procedure TForm1.Button18Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_11;
  ez:=gettickcount;
  label16.caption:=inttostr(ez-az);
end;

procedure TForm1.Button19Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_12;
  ez:=gettickcount;
  label17.caption:=inttostr(ez-az);
end;

procedure TForm1.Button20Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_13;
  ez:=gettickcount;
  label18.caption:=inttostr(ez-az);
end;

procedure TForm1.Button21Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_14;
  ez:=gettickcount;
  label19.caption:=inttostr(ez-az);
end;

procedure TForm1.Button22Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_15;
  ez:=gettickcount;
  label20.caption:=inttostr(ez-az);

  // Automatische Umschaltung der Baudrate vom PC Programm
  FTDI_close;
  portopen := 0;
  ButtonOFF;
  sleep(500);
  combobox2.ItemIndex := strtoint(edit36.text) - 1;
  SetzeBaudrate;

  FTDI_open;
  ButtonOn;
  PortOpen := 2;
end;

procedure TForm1.Button23Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_16;
  ez:=gettickcount;
  label21.caption:=inttostr(ez-az);
end;

procedure TForm1.Button24Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_17;
  ez:=gettickcount;
  label22.caption:=inttostr(ez-az);
end;

procedure TForm1.Button25Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_18;
  ez:=gettickcount;
  label23.caption:=inttostr(ez-az);
end;

procedure TForm1.Button26Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_19;
  ez:=gettickcount;
  label24.caption:=inttostr(ez-az);
end;

procedure TForm1.Button27Click(Sender: TObject);
var az,ez:integer;
begin
  az:=gettickcount;
  SendBefehl_20;
  ez:=gettickcount;
  label25.caption:=inttostr(ez-az);
end;








procedure TForm1.ComboBox2Click(Sender: TObject);
begin

  FTDI_close;
  portopen := 0;
  ButtonOFF;

  {case combobox2.ItemIndex of
    0: FT_Current_Baud := FT_BAUD_9600;
    1: FT_Current_Baud := FT_BAUD_14400;
    2: FT_Current_Baud := FT_BAUD_19200;
    3: FT_Current_Baud := FT_BAUD_38400;
    4: FT_Current_Baud := FT_BAUD_57600;
    5: FT_Current_Baud := FT_BAUD_115200;
    6: FT_Current_Baud := FT_BAUD_230400;
    7: FT_Current_Baud := FT_BAUD_460800;
    8: FT_Current_Baud := FT_BAUD_921600;
  end; }
  SetzeBaudrate;

  FTDI_open;
  ButtonOn;
  PortOpen := 2;

end;

procedure Tform1.SetzeBaudrate;
begin
  case combobox2.ItemIndex of
    0: FT_Current_Baud := FT_BAUD_9600;
    1: FT_Current_Baud := FT_BAUD_14400;
    2: FT_Current_Baud := FT_BAUD_19200;
    3: FT_Current_Baud := FT_BAUD_38400;
    4: FT_Current_Baud := FT_BAUD_57600;
    5: FT_Current_Baud := FT_BAUD_115200;
    6: FT_Current_Baud := FT_BAUD_230400;
    7: FT_Current_Baud := FT_BAUD_460800;
    8: FT_Current_Baud := FT_BAUD_921600;
  end;
end;

end.
